# Flood Control

Этот проект создан в рамках стажировки в VK по направлению Golang-разработка.

Проект реализует механизм контроля флуда, ограничивая количество запросов, сделанных в определенный промежуток времени. 

Решение основано на алгоритме Token Bucket и использует Redis в качестве хранилища для токенов.

## Описание

### Алгоритм

Для контроля скорости входящих запросов был выбран алгоритм ограничения скорости запросов Token Bucket из-за его простоты и эффективности. 

При таком подходе каждому пользователю назначается изначально заполненный бакет фиксированного размера.
При получении запроса бакет пополняется на часть токена, равную `S * RPS`, где `S` - количество секунд, прошедших с последнего запроса, а `RPS` (Request Per Second) - максимальное количество запросов в секунду. Далее из бакета извлекается токен. Если бакет пуст, то запрос ограничивается или отклоняется.

### Хранение данных

Для хранения данных о бакетах пользователей был выбран Redis из-за простоты его использования и скорости работы. 

В состояние бакета входит количество доступных токенов и метка времени последнего пополнения токена. 

Для гарантии корректной работы приложения при одновременной работе нескольких экземпляров был использован механизм транзакций Redis. Все операции с хранилищем проводятся в рамках одной атомарной транзакции, минимизируя риск состязательных ситуаций или несогласованного состояния.

## Конфигурация

Реализация поддерживает настраиваемые параметры для изменения поведения механизма контроля флуда. Параметры указываются в виде параметров командной строки:

```
limiter.n - Окно ограничения скорости в секундах
limiter.k - Максимальное количество запросов в N секунд
```

Полный список параметров можно получить через команду:

```
make help
```

## Запуск

При запуске приложение отправляет 20 запросов с задержкой в 100 миллисекунд. 
Если запрос прошел успешно, то в консоль выводится строка `"Request allowed"`. 
В противном случае - `"Request denied"`.

Чтобы запустить проект в режиме разработки нужно:

1. Клонировать репозиторий:
   
   ```
   git clone https://github.com/NikitaShlyakhtin/flood-control-task
   ```

2. Перейти в директорию проекта:

    ```
    cd flood-control-task
    ```

3. Установить зависимости:

    ```
    go mod download
    ```

4. Запустить программу:

    ```
    make run/fc
    ```

### Требования:
  
При таком режиме запуска у вас должен быть предустановлен Golang и запущен сервер Redis. 
Приложение по умолчанию использует адрес Redis сервера `localhost:6379`. Адрес, пароль и имя базы данных можно изменить через соответствующие параметры командной строки.

## Запуск через Docker (рекомендовано)

Вы также можете запустить приложение через Docker.

Для этого нужно:

1. Клонировать репозиторий:
   
   ```
   git clone https://github.com/NikitaShlyakhtin/flood-control-task
   ```

2. Перейти в директорию проекта:

    ```
    cd flood-control-task
    ```

3. Запустить окружение:

    ```
    docker-compose up --build
    ```

При запуске через Docker вам не нужно устанавливать Golang и запускать Redis сервер. 

Параметры фильтрации флуда можно изменить в `.env` файле в корне проекта.


